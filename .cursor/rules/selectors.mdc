---
description: Selector strategy rules for Playwright / ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼æˆ¦ç•¥ãƒ«ãƒ¼ãƒ«
globs:
alwaysApply: true
---

# ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼æˆ¦ç•¥ / Selector Strategy

## å„ªå…ˆåº¦ï¼ˆå¿…é ˆéµå®ˆï¼‰ / Priority (Must Follow)

### ğŸ“Š **ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼å„ªå…ˆåº¦ä¸€è¦§ï¼ˆå…¬å¼æ¨å¥¨é †ï¼‰**

| å„ªå…ˆåº¦ | ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼       | é¸æŠåŸºæº–       | å®‰å®šæ€§ | ä¾‹                                          |
| ------ | ---------------- | -------------- | ------ | ------------------------------------------- |
| **1**  | **Role-based**   | è¦ç´ ã®å½¹å‰²     | â­â­â­â­â­  | `getByRole('button', { name: 'ãƒ­ã‚°ã‚¤ãƒ³' })` |
| **2**  | **Text-based**   | è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆ   | â­â­â­â­   | `getByText('ä¿å­˜')`                         |
| **3**  | **Label-based**  | ãƒ•ã‚©ãƒ¼ãƒ ãƒ©ãƒ™ãƒ« | â­â­â­â­   | `getByLabel('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰')`                  |
| **4**  | **CSS Selector** | CSSã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼  | â­â­     | `locator('.btn-primary')` â† **é¿ã‘ã‚‹ã¹ã**  |

---

## ğŸ¯ **åŸºæœ¬ãƒ«ãƒ¼ãƒ«**

### âœ… **æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³**
```typescript
// 1. ãƒœã‚¿ãƒ³ãƒ»ãƒªãƒ³ã‚¯ãƒ»è¦‹å‡ºã—
await page.getByRole('button', { name: 'ãƒ­ã‚°ã‚¤ãƒ³' });
await page.getByRole('link', { name: 'ãƒ›ãƒ¼ãƒ ' });

// 2. ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ 
await page.getByLabel('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹');
await page.getByPlaceholder('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›');

// 3. è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆ
await page.getByText('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
```

### âŒ **ç¦æ­¢ãƒ‘ã‚¿ãƒ¼ãƒ³**
```typescript
// CSSã‚¯ãƒ©ã‚¹ãƒ»IDä¾å­˜ï¼ˆãƒ‡ã‚¶ã‚¤ãƒ³å¤‰æ›´ã§ç ´ç¶»ï¼‰
await page.locator('.btn-primary');
await page.locator('#submit-button');

// ä½¿ç”¨æ™‚ã¯å¿…ãšã‚³ãƒ¡ãƒ³ãƒˆã§ç†ç”±ã‚’æ˜è¨˜
// ã€å¤–éƒ¨ã‚µã‚¤ãƒˆåˆ¶ç´„ã«ã‚ˆã‚Šæœ€çµ‚æ‰‹æ®µã¨ã—ã¦ä½¿ç”¨ã€‘
await page.locator('.external-class');
```

---

## ğŸ§  **é¸å®šãƒ•ãƒ­ãƒ¼**

### **æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹**
```mermaid
flowchart TD
    A[è¦ç´ ã‚’é¸æŠã—ãŸã„] --> B{è¦ç´ ã®ç¨®é¡ã¯ï¼Ÿ}
    
    B -->|ãƒœã‚¿ãƒ³ãƒ»ãƒªãƒ³ã‚¯ãƒ»è¦‹å‡ºã—| C[Role-based ã‚’è©¦ã™]
    B -->|ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ | D[Label-based ã‚’è©¦ã™]
    B -->|ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºè¦ç´ | E[Text-based ã‚’è©¦ã™]
    
    C --> F{getByRole ã§é¸æŠå¯èƒ½ï¼Ÿ}
    F -->|âœ… å¯èƒ½| G[Role-based ã‚’ä½¿ç”¨]
    F -->|âŒ ä¸å¯èƒ½| H[æ¬¡ã®å„ªå…ˆåº¦ã‚’æ¤œè¨]
    
    D --> I{getByLabel ã§é¸æŠå¯èƒ½ï¼Ÿ}
    I -->|âœ… å¯èƒ½| J[Label-based ã‚’ä½¿ç”¨]
    I -->|âŒ ä¸å¯èƒ½| H
    
    E --> K{getByText ã§é¸æŠå¯èƒ½ï¼Ÿ}
    K -->|âœ… å¯èƒ½| L[Text-based ã‚’ä½¿ç”¨]
    K -->|âŒ ä¸å¯èƒ½| H
    
    H --> M[CSS Selector ã‚’ä½¿ç”¨<br/>â€»ç†ç”±ã‚’ã‚³ãƒ¡ãƒ³ãƒˆè¨˜è¼‰]
```

### **å„ªå…ˆåº¦ã®ç†ç”±ï¼ˆå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæº–æ‹ ï¼‰**
- **Role-based (1ç•ª)**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦ç´ ã‚’èªè­˜ã™ã‚‹æ–¹æ³•ã¨åŒã˜ â†’ æœ€ã‚‚å®‰å®š
- **Text-based (2ç•ª)**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã‚‹è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆ â†’ ç›´æ„Ÿçš„ã§å®‰å®š
- **Label-based (3ç•ª)**: ãƒ•ã‚©ãƒ¼ãƒ ã®èª¬æ˜ãƒ†ã‚­ã‚¹ãƒˆ â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦–ç‚¹
- **CSS Selector (4ç•ª)**: å®Ÿè£…è©³ç´°ä¾å­˜ â†’ å¤‰æ›´ã§å³ç ´ç¶»ï¼ˆé¿ã‘ã‚‹ã¹ãï¼‰

### **å±æ€§ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã®ä¾‹**
```typescript
// å±æ€§ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ï¼ˆä¸­é–“çš„ãªé¸æŠè‚¢ï¼‰
await page.locator('input[name="email"]');        // nameå±æ€§
await page.locator('button[type="submit"]');      // typeå±æ€§
await page.locator('[data-testid="submit"]');     // ãƒ†ã‚¹ãƒˆå°‚ç”¨å±æ€§
```

### **å®Ÿè£…ä¾‹**
```typescript
// âœ… è‰¯ã„ä¾‹
await page.getByRole('button', { name: 'ãƒ­ã‚°ã‚¤ãƒ³' });     // ãƒœã‚¿ãƒ³
await page.getByLabel('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹');                  // å…¥åŠ›æ¬„
await page.getByText('ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ');                 // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

// âŒ æ‚ªã„ä¾‹
await page.locator('.login-btn');                         // ã‚¯ãƒ©ã‚¹ä¾å­˜
await page.locator('#email-input');                       // IDä¾å­˜
```

## ğŸš« **ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³**

### **ãªãœCSS SelectorãŒå±é™ºã‹ï¼ˆå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæº–æ‹ ï¼‰**
- ğŸ’¥ **å³åº§ã«ç ´ç¶»**: ãƒ‡ã‚¶ã‚¤ãƒ³å¤‰æ›´ã§ãƒ†ã‚¹ãƒˆãŒä¸€æ–‰ã«å¤±æ•—
- ğŸ¨ **ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼è² æ‹…**: ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´ã®ãŸã³ã«ãƒ†ã‚¹ãƒˆä¿®æ­£ãŒå¿…è¦
- ğŸš« **å®Ÿè£…è©³ç´°ä¾å­˜**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ãˆãªã„å®Ÿè£…è©³ç´°ã«ä¾å­˜
- âŒ **å…¬å¼éæ¨å¥¨**: [Playwrightå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://playwright.dev/docs/best-practices#use-locators)ã§é¿ã‘ã‚‹ã¹ãã¨æ˜è¨˜

### **å…·ä½“ä¾‹**
```typescript
// âŒ å•é¡Œã®ã‚ã‚‹ä¾‹
await page.locator('.btn-blue').click();
// â†’ ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ãŒé’ã‹ã‚‰ç·‘ã«å¤‰æ›´ â†’ '.btn-green' â†’ ãƒ†ã‚¹ãƒˆç ´ç¶»

// âœ… æ”¹å–„ä¾‹
await page.getByRole('button', { name: 'ãƒ­ã‚°ã‚¤ãƒ³' }).click();
// â†’ è‰²ãŒå¤‰ã‚ã£ã¦ã‚‚ãƒœã‚¿ãƒ³ã®å½¹å‰²ã¯å¤‰ã‚ã‚‰ãªã„ â†’ ãƒ†ã‚¹ãƒˆç¶™ç¶šå‹•ä½œ
```

## ğŸ“š **å‚è€ƒè³‡æ–™**
- [Playwright Best Practices](https://playwright.dev/docs/best-practices)
- [Playwright Locators - Comprehensive Guide](https://bugbug.io/blog/testing-frameworks/playwright-locators/)
- [Testing Library Queries](https://testing-library.com/docs/queries/about/)
- [Making your UI tests resilient to change - Kent C. Dodds](https://kentcdodds.com/
blog/making-your-ui-tests-resilient-to-change)
- [idã‚„classã‚’ä½¿ã£ã¦ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã®ã¯ã€ã‚‚ã¯ã‚„ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚ã‚‹](https://qiita.com/akameco/
items/519f7e4d5442b2a9d2da)
