---
description: Architecture rules for Playwright tests / ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ«ãƒ¼ãƒ«
globs:
alwaysApply: false
---

# ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ«ãƒ¼ãƒ« / Architecture Rules

## Page Object Modelï¼ˆå¿…é ˆï¼‰ / Page Object Model (Required)

### åŸºæœ¬æ§‹é€  / Basic Structure
```typescript
export class PageName extends BasePage {
  readonly elementName: Locator;
  
  constructor(page: Page, logManager?: LogManager) {
    super(page, logManager); // âœ… ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ
    this.elementName = this.page.getByRole('button', { name: 'Submit' });
  }
  
  async actionMethod(): Promise<void> {
    // âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šã¨ãƒ­ã‚°
    this.startPerformanceMeasurement();
    this.logInfo('ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹');
    
    try {
      // å®Ÿè£… / Implementation
      await this.elementName.click();
      
      this.logPerformance('ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Œäº†', {
        action: 'click',
        element: 'Submit',
      });
    } catch (error) {
      this.logError('ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¤±æ•—', error as Error);
      throw error;
    }
  }
}
```

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆå®Ÿè£…æº–æ‹ ï¼‰ / Directory Structure (Implementation-based)
```
tests/
â”œâ”€â”€ pages/           # Page Objectã‚¯ãƒ©ã‚¹ / Page Object classes
â”‚   â”œâ”€â”€ BasePage.ts              # åŸºåº•ã‚¯ãƒ©ã‚¹ / Base class
â”‚   â”œâ”€â”€ PlaywrightDevPage.ts     # VRTãƒ»å…¬å¼ã‚µã‚¤ãƒˆç”¨ / VRT & official site
â”‚   â”œâ”€â”€ W3SchoolsFormPage.ts     # iframeãƒ»å¤–éƒ¨ãƒ•ã‚©ãƒ¼ãƒ ç”¨ / iframe & external form
â”‚   â”œâ”€â”€ CSVTestPage.ts           # ãƒ‡ãƒ¼ã‚¿é§†å‹•ãƒ†ã‚¹ãƒˆç”¨ / Data-driven testing
â”‚   â””â”€â”€ LocatorTestPage.ts       # ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼æˆ¦ç•¥ãƒ‡ãƒ¢ç”¨ / Selector strategy demo
â”œâ”€â”€ fixtures/        # ãƒ†ã‚¹ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ / Test fixtures
â”‚   â””â”€â”€ TestFixtures.ts          # èªè¨¼ãƒ»ãƒ­ã‚®ãƒ³ã‚°ãƒ»Pageæ³¨å…¥ / Auth, logging, Page injection
â”œâ”€â”€ utils/          # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ / Utilities
â”‚   â”œâ”€â”€ TestConfig.ts            # ç’°å¢ƒè¨­å®šãƒ»èªè¨¼æƒ…å ±ç®¡ç† / Config & credentials
â”‚   â”œâ”€â”€ TestLogger.ts            # çµ±ä¸€ãƒ­ã‚°ãƒ»ã‚¹ãƒ†ãƒƒãƒ—è¿½è·¡ / Unified logging (legacy)
â”‚   â”œâ”€â”€ QualityBaseline.ts       # å“è³ªãƒã‚§ãƒƒã‚¯ãƒ»è©•ä¾¡åŸºæº– / Quality baseline
â”‚   â””â”€â”€ logging/                 # æ–°ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ  / New logging system
â”‚       â”œâ”€â”€ LogManager.ts        # ä¸­æ ¸ãƒ­ã‚°ç®¡ç† / Core log management
â”‚       â”œâ”€â”€ types.ts             # å‹å®šç¾© / Type definitions
â”‚       â”œâ”€â”€ index.ts             # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ / Exports
â”‚       â””â”€â”€ emitters/            # ãƒ­ã‚°å‡ºåŠ›å…ˆ / Log output destinations
â”œâ”€â”€ data/           # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ / Test data
â”‚   â”œâ”€â”€ TestData.ts              # é™çš„ãƒ»å‹•çš„ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ / Static & dynamic data
â”‚   â””â”€â”€ test.csv                 # CSVé§†å‹•ãƒ†ã‚¹ãƒˆç”¨ / CSV-driven testing
â”œâ”€â”€ archive/        # å“è³ªå‘ä¸Šå¯¾è±¡å¤–ï¼ˆå‚è€ƒå®Ÿè£…ï¼‰ / Reference implementations
â”‚   â””â”€â”€ *.spec.ts               # æ®µéšçš„æ”¹å–„å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« / Gradual improvement targets
â”œâ”€â”€ VRT.spec.ts     # Visual Regression Testing
â”œâ”€â”€ auth.setup.ts   # èªè¨¼ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— / Authentication setup
â””â”€â”€ *-snapshots/    # VRTãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç”»åƒ / VRT baseline images
```

## å‘½åè¦å‰‡ / Naming Conventions

### ãƒ•ã‚¡ã‚¤ãƒ«å‘½å / File Naming
- ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: `*.spec.ts` / Test files: `*.spec.ts`
- Page Object: `*Page.ts`
- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£: `*.util.ts` / Utilities: `*.util.ts`

### ã‚¯ãƒ©ã‚¹å‘½å / Class Naming
- Page Object: `XxxPage extends BasePage`
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿: `XxxTestData`
- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£: `XxxUtil`

## expect/asserté…ç½®æˆ¦ç•¥ / Expect/Assert Placement Strategy

### åŸºæœ¬æ–¹é‡ï¼ˆPlaywrightå…¬å¼æº–æ‹ ï¼‰ / Basic Policy (Playwright Official Compliant)
- **Page Objectå†…**: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ™‚ã®åŸºæœ¬æˆåŠŸç¢ºèª / Basic success verification for actions
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å†…**: ãƒ†ã‚¹ãƒˆå›ºæœ‰ã®è©³ç´°æ¤œè¨¼ / Test-specific detailed verification

### è©³ç´°ãƒ«ãƒ¼ãƒ« / Detailed Rules
- **è©³ç´°ã‚¬ã‚¤ãƒ‰**: [expect-strategy.mdc](expect-strategy.mdc)

## ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ / Test File Implementation Patterns

### âœ… **æ–°ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆ / New Logging System Integration**
```typescript
// âœ… æ­£ã—ã„ï¼šTestFixturesã‹ã‚‰logManagerã‚’å–å¾—
import { test, expect } from "./fixtures/TestFixtures";
import { PlaywrightDevPage } from "./pages/PlaywrightDevPage";
import { LogCategory } from "./utils/logging";

test("VRTãƒ†ã‚¹ãƒˆ", async ({ pageWithLogging, logManager }, testInfo) => {
  const playwrightPage = new PlaywrightDevPage(pageWithLogging, logManager);

  // âœ… ãƒ†ã‚¹ãƒˆé–‹å§‹ãƒ­ã‚°
  logManager.startTest(testInfo.title);
  
  try {
    // âœ… Given-When-Thenæ§‹é€ åŒ–ãƒ­ã‚°
    logManager.info("ğŸ === GIVEN: ãƒ†ã‚¹ãƒˆå‰ææ¡ä»¶ ===", LogCategory.TEST_EXECUTION);
    await playwrightPage.navigate(); // è‡ªå‹•çš„ã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šãƒ»ãƒ­ã‚°è¨˜éŒ²
    
    logManager.info("âš¡ === WHEN: VRTå®Ÿè¡Œ ===", LogCategory.TEST_EXECUTION);
    await playwrightPage.takeVRTScreenshot(); // è‡ªå‹•çš„ã«ãƒ­ã‚°è¨˜éŒ²
    
    logManager.info("âœ… === THEN: æˆåŠŸ ===", LogCategory.TEST_EXECUTION);
    
  } catch (error) {
    // ã‚¨ãƒ©ãƒ¼ã¯è‡ªå‹•çš„ã«Page Objectã§ãƒ­ã‚°è¨˜éŒ²ã•ã‚Œã‚‹
    throw error;
  }
});
```

### âŒ **é¿ã‘ã‚‹ã¹ããƒ‘ã‚¿ãƒ¼ãƒ³ / Patterns to Avoid**
```typescript
// âŒ é–“é•ã„ï¼šå¤ã„playwrightãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³
import { test, expect } from "@playwright/test";

test("ãƒ†ã‚¹ãƒˆ", async ({ page }) => {
  const playwrightPage = new PlaywrightDevPage(page); // logManagerä¸è¶³
  // ãƒ­ã‚°ãŒè¨˜éŒ²ã•ã‚Œãªã„
});
```

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ / Related Documents

è©³ç´°ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ãƒ»å®Ÿè£…ä¾‹ã¯ docs/architecture/ ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

For detailed architecture diagrams and implementation examples, refer to docs/architecture/.

### **é–¢é€£ãƒ«ãƒ¼ãƒ« / Related Rules**
- **ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ **: [logging.mdc](logging.mdc) - è²¬å‹™åˆ†é›¢ãƒ»å®Ÿè£…ãƒ«ãƒ¼ãƒ«
- **ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼æˆ¦ç•¥**: [selectors.mdc](selectors.mdc) - è¦ç´ é¸æŠãƒ‘ã‚¿ãƒ¼ãƒ³
- **ãƒ†ã‚¹ãƒˆæ§‹é€ **: [test-structure.mdc](test-structure.mdc) - Given-When-Thenæ§‹é€ 

## å‚è€ƒ / References
- https://playwright.dev/docs/pom
