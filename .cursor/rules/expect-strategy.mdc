# expecté…ç½®æˆ¦ç•¥ãƒ«ãƒ¼ãƒ« / Expect Placement Strategy Rules

## åŸºæœ¬æ–¹é‡ / Basic Policy

### Playwrightå…¬å¼æº–æ‹ ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ / Playwright Official Hybrid Approach
- **Page Objectå†…**: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ™‚ã®åŸºæœ¬æˆåŠŸç¢ºèª / Basic success verification for actions
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å†…**: ãƒ†ã‚¹ãƒˆå›ºæœ‰ã®è©³ç´°æ¤œè¨¼ / Test-specific detailed verification

## ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥å®Ÿè£…ã‚¬ã‚¤ãƒ‰ / File-specific Implementation Guide

### ğŸ“ **Page Objectãƒ•ã‚¡ã‚¤ãƒ« (tests/pages/\*.ts)**

#### âœ… **é…ç½®ã™ã¹ãexpect**
```typescript
// ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ™‚ã®åŸºæœ¬æˆåŠŸç¢ºèª
async navigate(): Promise<void> {
  await this.page.goto(this.url);
  await this.page.waitForLoadState("domcontentloaded");
  
  // åŸºæœ¬çš„ãªèª­ã¿è¾¼ã¿æˆåŠŸç¢ºèª
  await expect(this.heroSection).toBeVisible({ timeout: 10000 });
}

async clickButton(): Promise<void> {
  await this.submitButton.click();
  
  // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æˆåŠŸã®åŸºæœ¬ç¢ºèª
  await expect(this.page).toHaveURL(/success/);
}

async fillForm(data: FormData): Promise<void> {
  await this.nameInput.fill(data.name);
  await this.emailInput.fill(data.email);
  
  // å…¥åŠ›å€¤ã®åŸºæœ¬ç¢ºèª
  await expect(this.nameInput).toHaveValue(data.name);
  await expect(this.emailInput).toHaveValue(data.email);
}
```

#### âŒ **é…ç½®ã™ã¹ãã§ãªã„expect**
```typescript
// ãƒ†ã‚¹ãƒˆå›ºæœ‰ã®è©³ç´°æ¤œè¨¼ï¼ˆãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§å®Ÿè¡Œï¼‰
await expect(this.tableRows).toHaveCount(25);           // å…·ä½“çš„ãªä»¶æ•°
await expect(this.errorMessage).toHaveText("ç‰¹å®šã‚¨ãƒ©ãƒ¼"); // ç‰¹å®šã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
await expect(this.page).toHaveTitle(/ç‰¹å®šã®ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«/); // ç‰¹å®šã®ã‚¿ã‚¤ãƒˆãƒ«
```

### ğŸ“„ **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« (tests/\*.spec.ts)**

#### âœ… **é…ç½®ã™ã¹ãexpect**
```typescript
test("å…·ä½“çš„ãªãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹", async ({ page }) => {
  const pagePage = new SomePage(page);
  
  // Page Objectã®ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè¡Œï¼ˆåŸºæœ¬ç¢ºèªæ¸ˆã¿ï¼‰
  await somePage.navigate();
  await somePage.performAction();
  
  // ãƒ†ã‚¹ãƒˆå›ºæœ‰ã®è©³ç´°æ¤œè¨¼
  await expect(page).toHaveTitle(/æœŸå¾…ã•ã‚Œã‚‹ç‰¹å®šã®ã‚¿ã‚¤ãƒˆãƒ«/);
  await expect(page.locator('.result-table tr')).toHaveCount(10);
  await expect(page.locator('.error-message')).toContainText('æœŸå¾…ã•ã‚Œã‚‹ã‚¨ãƒ©ãƒ¼');
  
  // è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯æ¤œè¨¼
  const userCount = await page.locator('.user-count').textContent();
  const productCount = await page.locator('.product-count').textContent();
  expect(parseInt(userCount) + parseInt(productCount)).toBeGreaterThan(50);
});
```

#### âŒ **é…ç½®ã™ã¹ãã§ãªã„expect**
```typescript
// åŸºæœ¬çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æˆåŠŸç¢ºèªï¼ˆPage Objectã§å®Ÿè¡Œï¼‰
await expect(page.locator('main')).toBeVisible();  // â† Page Objectã§å®Ÿè¡Œ
await expect(page).toHaveURL(/dashboard/);          // â† ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§å®Ÿè¡Œ
```

## åˆ¤æ–­åŸºæº– / Decision Criteria

### **Page Objectå†…ã«é…ç½® / Place in Page Object**
- âœ… ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œã®å³åº§ãªç¢ºèª / Immediate action success verification
- âœ… ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†ã®ç¢ºèª / Page load completion verification  
- âœ… ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›å€¤ã®åŸºæœ¬ç¢ºèª / Basic form input verification
- âœ… ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æˆåŠŸã®ç¢ºèª / Navigation success verification
- âœ… å†åˆ©ç”¨å¯èƒ½ãªåŸºæœ¬æ¤œè¨¼ / Reusable basic verification

### **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å†…ã«é…ç½® / Place in Test File**
- âœ… ãƒ†ã‚¹ãƒˆå›ºæœ‰ã®æœŸå¾…å€¤æ¤œè¨¼ / Test-specific expected value verification
- âœ… å…·ä½“çš„ãªä»¶æ•°ãƒ»å†…å®¹ã®ç¢ºèª / Specific count/content verification
- âœ… è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯æ¤œè¨¼ / Complex business logic verification  
- âœ… è¤‡æ•°è¦ç´ ã®çµ„ã¿åˆã‚ã›æ¤œè¨¼ / Multiple element combination verification
- âœ… ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å›ºæœ‰ã®è©³ç´°ç¢ºèª / Test case specific detailed verification

## å®Ÿè£…ä¾‹ / Implementation Examples

### **PlaywrightDevPage.tsï¼ˆæ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰**
```typescript
export class PlaywrightDevPage extends BasePage {
  async navigate(): Promise<void> {
    try {
      await this.page.goto(this.url);
      await this.page.waitForLoadState("domcontentloaded");
      
      // åŸºæœ¬çš„ãªèª­ã¿è¾¼ã¿æˆåŠŸç¢ºèªï¼ˆPage Objectè²¬ä»»ï¼‰
      await expect(this.heroSection).toBeVisible({ timeout: 15000 });
    } catch (error) {
      await this.handleError(`ãƒšãƒ¼ã‚¸ç§»å‹•ã«å¤±æ•—: ${error}`);
      throw error;
    }
  }

  async clickGetStarted(): Promise<void> {
    try {
      await this.getStartedButton.click();
      
      // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æˆåŠŸã®åŸºæœ¬ç¢ºèªï¼ˆPage Objectè²¬ä»»ï¼‰
      await expect(this.page).toHaveURL(/docs/);
    } catch (error) {
      await this.handleError(`Get Startedã‚¯ãƒªãƒƒã‚¯ã«å¤±æ•—: ${error}`);
      throw error;
    }
  }

  // è©³ç´°æ¤œè¨¼ã¯å¼•ãç¶šãã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æä¾›
  async verifyMainElements(): Promise<void> {
    try {
      await expect(this.heroSection).toBeVisible();
      await expect(this.navigationMenu).toBeVisible();
    } catch (error) {
      await this.handleError(`è¦ç´ æ¤œè¨¼ã«å¤±æ•—: ${error}`);
      throw error;
    }
  }
}
```

### **VRT.spec.tsï¼ˆæ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰**
```typescript
test("Playwright.devãƒšãƒ¼ã‚¸ã®ã‚¿ã‚¤ãƒˆãƒ«æ¤œè¨¼", async ({ page }) => {
  const playwrightPage = new PlaywrightDevPage(page);

  // === GIVEN ===
  await playwrightPage.navigate(); // åŸºæœ¬ç¢ºèªæ¸ˆã¿

  // === WHEN & THEN ===
  // ãƒ†ã‚¹ãƒˆå›ºæœ‰ã®è©³ç´°æ¤œè¨¼ï¼ˆãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«è²¬ä»»ï¼‰
  await expect(page).toHaveTitle(/Fast and reliable end-to-end testing/);
  
  const title = await page.title();
  console.log(`âœ… æœŸå¾…ã•ã‚Œã‚‹ã‚¿ã‚¤ãƒˆãƒ«ã‚’ç¢ºèª: ${title}`);
});

test("Get Startedãƒœã‚¿ãƒ³ã®å‹•ä½œç¢ºèª", async ({ page }) => {
  const playwrightPage = new PlaywrightDevPage(page);

  await playwrightPage.navigate();               // åŸºæœ¬ç¢ºèªæ¸ˆã¿
  await playwrightPage.clickGetStarted();        // åŸºæœ¬ç¢ºèªæ¸ˆã¿

  // ãƒ†ã‚¹ãƒˆå›ºæœ‰ã®è©³ç´°æ¤œè¨¼
  await expect(page.locator('h1')).toContainText('Installation');
  await expect(page.locator('nav .active')).toContainText('Getting Started');
});
```

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° / Error Handling

### **Page Objectå†…**
```typescript
async actionMethod(): Promise<void> {
  try {
    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
    await this.element.click();
    
    // åŸºæœ¬æˆåŠŸç¢ºèª
    await expect(this.resultElement).toBeVisible();
  } catch (error) {
    // BasePage.handleError()ã‚’æ´»ç”¨
    await this.handleError(`actionMethodå®Ÿè¡Œã«å¤±æ•—: ${error}`);
    throw error; // ãƒ†ã‚¹ãƒˆå¤±æ•—ã¨ã—ã¦å†ã‚¹ãƒ­ãƒ¼
  }
}
```

### **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å†…**
```typescript
test("ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹", async ({ page }) => {
  try {
    // Page Objectãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè¡Œ
    await somePage.performAction();
    
    // ãƒ†ã‚¹ãƒˆå›ºæœ‰æ¤œè¨¼
    await expect(page).toHaveTitle(/æœŸå¾…ã‚¿ã‚¤ãƒˆãƒ«/);
  } catch (error) {
    // å¿…è¦ã«å¿œã˜ã¦ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼å‡¦ç†
    console.error(`ãƒ†ã‚¹ãƒˆå›ºæœ‰æ¤œè¨¼ã§ã‚¨ãƒ©ãƒ¼: ${error}`);
    throw error;
  }
});
```

## å‘½åè¦å‰‡ / Naming Conventions

### **Page Objectå†…ãƒ¡ã‚½ãƒƒãƒ‰**
- `navigate()`: ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ + åŸºæœ¬ç¢ºèª
- `click*()`: ã‚¯ãƒªãƒƒã‚¯ + åŸºæœ¬ç¢ºèª  
- `fill*()`: å…¥åŠ› + åŸºæœ¬ç¢ºèª
- `verify*()`: è©³ç´°æ¤œè¨¼ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å†…**
- ãƒ†ã‚¹ãƒˆåã§æ¤œè¨¼å†…å®¹ã‚’æ˜ç¢ºåŒ–
- Given-When-Thenæ§‹é€ ã§ã®æ•´ç†
- ãƒ†ã‚¹ãƒˆå›ºæœ‰ã®æœŸå¾…å€¤ã‚’æ˜ç¢ºã«è¨˜è¿°

## å“è³ªæŒ‡æ¨™ / Quality Metrics

### **Page Objectå“è³ª**
- åŸºæœ¬expectä½¿ç”¨ç‡: 80%ä»¥ä¸Šï¼ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ã‚ãŸã‚Šï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç‡: 100%
- å†åˆ©ç”¨å¯èƒ½æ€§: è¤‡æ•°ãƒ†ã‚¹ãƒˆã§ã®ä½¿ç”¨

### **ãƒ†ã‚¹ãƒˆå“è³ª**
- ãƒ†ã‚¹ãƒˆå›ºæœ‰expectä½¿ç”¨ç‡: 1-5å€‹/ãƒ†ã‚¹ãƒˆ
- Given-When-Thenæ§‹é€ : 100%éµå®ˆ
- ä¸»è¦ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³æ˜ç¢ºæ€§: 1ã¤/ãƒ†ã‚¹ãƒˆ

## å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ / Implementation Checklist

### **Page Objectå®Ÿè£…æ™‚**
- [ ] ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ã«åŸºæœ¬æˆåŠŸç¢ºèªã®expectã‚’å«ã‚€
- [ ] try-catchã§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å®Ÿè£…
- [ ] BasePage.handleError()ã‚’æ´»ç”¨
- [ ] å†åˆ©ç”¨å¯èƒ½ãªè¨­è¨ˆ

### **ãƒ†ã‚¹ãƒˆå®Ÿè£…æ™‚**
- [ ] Page Objectãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨
- [ ] ãƒ†ã‚¹ãƒˆå›ºæœ‰ã®è©³ç´°æ¤œè¨¼ã‚’ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å†…ã§å®Ÿè¡Œ
- [ ] Given-When-Thenæ§‹é€ ã‚’ç¶­æŒ
- [ ] ä¸»è¦ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ˜ç¢ºåŒ–

## ç§»è¡ŒæŒ‡é‡ / Migration Guidelines

### **æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®ç§»è¡Œ**
1. Page Objectå†…ã®è©³ç´°æ¤œè¨¼ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç¢ºèª
2. ãƒ†ã‚¹ãƒˆå›ºæœ‰ã®æ¤œè¨¼ã‚’ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«ç§»å‹•
3. ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ã«åŸºæœ¬æˆåŠŸç¢ºèªã‚’è¿½åŠ 
4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€

### **æ–°è¦å®Ÿè£…**
1. ã“ã®æˆ¦ç•¥ã«å¾“ã£ãŸå®Ÿè£…
2. å…¬å¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å‚è€ƒ
3. ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã®ç¢ºèª
4. å“è³ªæŒ‡æ¨™ã®æ¸¬å®š