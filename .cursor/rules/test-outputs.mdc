---
description: Test output management rules / ãƒ†ã‚¹ãƒˆå‡ºåŠ›ç‰©ç®¡ç†ãƒ«ãƒ¼ãƒ«
globs:
alwaysApply: false
---

# ãƒ†ã‚¹ãƒˆå‡ºåŠ›ç‰©ç®¡ç†ãƒ«ãƒ¼ãƒ«

## ğŸš€ åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰ï¼ˆPlaywrightå…¬å¼æ¨å¥¨ï¼‰

```bash
npm test               # Chromiumã®ã¿ï¼ˆé«˜é€Ÿé–‹ç™ºç”¨ï¼‰
npm run test:all       # å…¨ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆãƒªãƒªãƒ¼ã‚¹å‰æ¤œè¨¼ï¼‰
npm run test:ui        # UIãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
npm run report         # çµæœç¢ºèª
npm run clean          # ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
npm run typecheck      # å‹ãƒã‚§ãƒƒã‚¯
```

### ç›´æ¥å®Ÿè¡Œï¼ˆå…¬å¼ã‚³ãƒãƒ³ãƒ‰æ´»ç”¨ï¼‰
```bash
npx playwright test --headed    # ãƒ–ãƒ©ã‚¦ã‚¶è¡¨ç¤º
npx playwright test --debug     # ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œ
du -sh test-results/ playwright-report/  # ã‚µã‚¤ã‚ºç¢ºèª
```

## ğŸ“ å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆPlaywrightå…¬å¼ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰

### ğŸ”„ **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœ**
```
test-results/          # Playwrightå…¬å¼ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
â”œâ”€â”€ screenshots/       # å¤±æ•—æ™‚ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
â”œâ”€â”€ videos/           # å®Ÿè¡ŒéŒ²ç”»
â”œâ”€â”€ traces/           # ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ *-actual.png      # VRTå®Ÿéš›ç”»åƒ
```

### ğŸ“Š **HTMLãƒ¬ãƒãƒ¼ãƒˆ**
```
playwright-report/     # Playwrightå…¬å¼ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
â””â”€â”€ index.html
```

### ğŸ“¸ **ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç”»åƒï¼ˆæ°¸ç¶šç®¡ç†ï¼‰**
```
tests/*-snapshots/     # VRTãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç”»åƒ
â”œâ”€â”€ VRT-1-chromium-darwin.png
â”œâ”€â”€ VRT-1-webkit-darwin.png
â””â”€â”€ VRT-1-firefox-darwin.png
```
**ç®¡ç†æ–¹é‡**: Gitç®¡ç†ãƒ»ãƒãƒ¼ãƒ å…±æœ‰ãƒ»æ…é‡ãªæ›´æ–°

## ğŸ—‚ï¸ .gitignore è¨­å®šï¼ˆå¿…é ˆï¼‰

### é™¤å¤–ã™ã¹ããƒ•ã‚¡ã‚¤ãƒ«
```gitignore
# ãƒ†ã‚¹ãƒˆçµæœï¼ˆä¸€æ™‚çš„ï¼‰
/test-results/
/playwright-report/
/blob-report/

# Playwrightå†…éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«
/playwright/.cache/
/playwright/.auth/

# ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«
*.log
yarn-error.log

# ç’°å¢ƒè¨­å®š
*.env*
!.env.example

# ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«
*.tmp
*.temp
```

### **å«ã‚ã‚‹ã¹ããƒ•ã‚¡ã‚¤ãƒ«**
```gitignore
# VRTãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç”»åƒã¯å«ã‚ã‚‹
!tests/*-snapshots/*.png
```

## ğŸ§¹ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æˆ¦ç•¥

### **è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆæ¨å¥¨ï¼‰**
```json
// package.json
{
  "scripts": {
    "test": "playwright test",
    "test:clean": "npm run clean && npm run test",
    "clean": "npm run clean:results && npm run clean:reports",
    "clean:results": "rm -rf test-results",
    "clean:reports": "rm -rf playwright-report blob-report",
    "clean:old": "find test-results -name '*.png' -mtime +7 -delete"
  }
}
```

### **æ‰‹å‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**
```bash
# åŸºæœ¬ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
npm run clean

# å¤ã„ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å‰Šé™¤ï¼ˆ7æ—¥ä»¥ä¸Šå‰ï¼‰
npm run clean:old

# å®Œå…¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆæ³¨æ„ï¼šVRTãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã¯æ®‹ã™ï¼‰
rm -rf test-results playwright-report
```

## ğŸ“¤ CI/CD ã§ã®ç®¡ç†

### **ä¿å­˜ã™ã¹ãæˆæœç‰©**
- âœ… HTMLãƒ¬ãƒãƒ¼ãƒˆ (`playwright-report/`)
- âœ… å¤±æ•—æ™‚ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãƒ»å‹•ç”»
- âœ… æ–°ã—ã„VRTãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç”»åƒï¼ˆæ‰¿èªå¾Œï¼‰

### **GitHub Actionsä¾‹**
```yaml
- name: Run Playwright tests
  run: npx playwright test

- name: Upload test results
  uses: actions/upload-artifact@v3
  if: always()
  with:
    name: playwright-report
    path: |
      playwright-report/
      test-results/
    retention-days: 30
```

## ğŸ¯ VRTï¼ˆVisual Regression Testingï¼‰ç®¡ç†

### **ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç”»åƒã®æ›´æ–°**
```bash
# æ„å›³çš„ãªå¤‰æ›´æ™‚ã®ã¿å®Ÿè¡Œ
npx playwright test --update-snapshots

# ç‰¹å®šãƒ†ã‚¹ãƒˆã®ã¿æ›´æ–°
npx playwright test tests/VRT.spec.ts --update-snapshots
```

### **VRTå¤±æ•—æ™‚ã®å¯¾å¿œãƒ•ãƒ­ãƒ¼**
1. **å·®åˆ†ç¢ºèª**: `test-results/*-diff.png` ã§å¤‰æ›´å†…å®¹ç¢ºèª
2. **åŸå› èª¿æŸ»**: æ„å›³çš„å¤‰æ›´ vs ãƒã‚°ã«ã‚ˆã‚‹å¤‰æ›´
3. **æ‰¿èª**: æ„å›³çš„å¤‰æ›´ãªã‚‰ `--update-snapshots` ã§æ›´æ–°
4. **ä¿®æ­£**: ãƒã‚°ãªã‚‰è©²å½“ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£

## ğŸ“Š å®¹é‡ç®¡ç†

### **ç›£è¦–ã™ã¹ããƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**
```bash
# å®šæœŸçš„ã«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
du -sh test-results/ playwright-report/

# è‚¥å¤§åŒ–ã®è­¦å‘Šãƒ©ã‚¤ãƒ³
# test-results: 50MBä»¥ä¸Š
# playwright-report: 10MBä»¥ä¸Š
```

### **å®¹é‡å‰Šæ¸›ç­–**
```bash
# å‹•ç”»å“è³ªèª¿æ•´ï¼ˆplaywright.config.tsï¼‰
recordVideo: {
  mode: 'retain-on-failure',
  size: { width: 1280, height: 720 }  // è§£åƒåº¦ä¸‹ã’ã‚‹
}

# ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆè¨­å®š
screenshot: 'only-on-failure'  # å¤±æ•—æ™‚ã®ã¿
```

## ğŸ¤ ãƒãƒ¼ãƒ å…±æœ‰ã®åŸå‰‡

### **å…±æœ‰ã™ã¹ãã‚‚ã®**
- âœ… VRTãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç”»åƒï¼ˆtests/*-snapshots/ï¼‰
- âœ… è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆplaywright.config.tsï¼‰
- âœ… ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰

### **å…±æœ‰ä¸è¦**
- âŒ ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œçµæœï¼ˆtest-results/ï¼‰
- âŒ HTMLãƒ¬ãƒãƒ¼ãƒˆï¼ˆplaywright-report/ï¼‰
- âŒ ä¸€æ™‚çš„ãªã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãƒ»å‹•ç”»

### **å¤±æ•—æ™‚ã®å…±æœ‰æ–¹æ³•**
```bash
# CI/CDã§ã®å¤±æ•—æ™‚
# â†’ GitHub Actionsã®Artifactsã§å…±æœ‰

# ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®å†ç¾å›°é›£ãªå¤±æ•—
# â†’ test-results/ ã‚’ zip ã§å…±æœ‰
zip -r debug-results.zip test-results/
```

## âš™ï¸ è¨­å®šæœ€é©åŒ–

### **playwright.config.ts æ¨å¥¨è¨­å®š**
```typescript
export default defineConfig({
  use: {
    // å¤±æ•—æ™‚ã®ã¿è¨˜éŒ²ï¼ˆå®¹é‡ç¯€ç´„ï¼‰
    screenshot: 'only-on-failure',
    video: 'retain-on-failure',
    trace: 'on-first-retry',
  },
  
  // å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ•´ç†
  outputDir: 'test-results',
  
  // ãƒ¬ãƒãƒ¼ãƒˆè¨­å®š
  reporter: [
    ['html', { outputFolder: 'playwright-report' }],
    ['json', { outputFile: 'test-results/results.json' }]
  ]
});
```

## ğŸš¨ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### **ã‚ˆãã‚ã‚‹å•é¡Œ**

1. **å®¹é‡ä¸è¶³**
   ```bash
   # åŸå› : test-results/ ã®è‚¥å¤§åŒ–
   # å¯¾ç­–: å®šæœŸçš„ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
   npm run clean:old
   ```

2. **VRTå·®åˆ†ã‚¨ãƒ©ãƒ¼**
   ```bash
   # åŸå› : æ„å›³ã—ãªã„ç”»é¢å¤‰æ›´
   # å¯¾ç­–: å·®åˆ†ç”»åƒã§å¤‰æ›´å†…å®¹ç¢ºèª
   open test-results/*/VRT-1-diff.png
   ```

3. **CI/CDã§ã®æˆæœç‰©ç´›å¤±**
   ```yaml
   # åŸå› : retention-days è¨­å®šä¸å‚™
   # å¯¾ç­–: é©åˆ‡ãªä¿æŒæœŸé–“è¨­å®š
   retention-days: 30  # 30æ—¥é–“ä¿æŒ
   ```

## ğŸ“‹ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### **é–‹ç™ºæ™‚**
- [ ] ãƒ†ã‚¹ãƒˆå‰ã« `npm run clean` ã§ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- [ ] VRTå¤‰æ›´æ™‚ã¯å·®åˆ†ã‚’å¿…ãšç¢ºèª
- [ ] å¤§é‡ã®å¤±æ•—ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ®‹ã£ã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯

### **CI/CDè¨­å®šæ™‚**
- [ ] HTMLãƒ¬ãƒãƒ¼ãƒˆã®æˆæœç‰©ä¿å­˜è¨­å®š
- [ ] é©åˆ‡ãªä¿æŒæœŸé–“è¨­å®šï¼ˆ30æ—¥æ¨å¥¨ï¼‰
- [ ] VRTãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç”»åƒã®è‡ªå‹•æ›´æ–°é˜²æ­¢

### **å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ï¼ˆé€±æ¬¡ï¼‰**
- [ ] test-results/ ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
- [ ] å¤ã„ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—  
- [ ] .gitignore è¨­å®šã®è¦‹ç›´ã—