# 📋 ログ責務分離計画

## 🎯 既存設計の維持方針

**✅ 変更しないもの**
- 各ファイルの行数（100-200行程度を維持）
- BasePage > XXX継承パターン
- テストファイルの簡潔性（1テスト15-25行）
- 既存のTestLoggerとの共存

**🔧 強化するもの**
- 各レイヤーにLogManagerを最小限追加
- Given-When-Thenログの統一
- パフォーマンス測定の自動化

## 🏗️ 責務分離マップ

### 1️⃣ **BasePage.ts** - 基底レイヤー（現在49行）
```typescript
// 追加する責務
- LogManager初期化（オプション）
- 共通ログメソッド（logInfo, logError等）
- パフォーマンス測定の基盤

// 追加後の予想行数: 70-80行
```

### 2️⃣ **Page Objects** - ページレイヤー（現在130-160行）
```typescript
// PlaywrightDevPage.ts / LocatorTestPage.ts
// 追加する責務
- ページ固有操作のログ（navigate, click等）
- メソッド内でのパフォーマンス測定
- VRT固有ログ（PlaywrightDevPageのみ）

// 追加後の予想行数: 180-200行
```

### 3️⃣ **Fixtures** - システムレイヤー（現在137行）
```typescript
// TestFixtures.ts  
// 追加する責務
- 新LogManagerの初期化・提供
- テストライフサイクルログ
- システムイベントのログ強化

// 追加後の予想行数: 180-200行
```

### 4️⃣ **Test Files** - テストレイヤー（現在110行）
```typescript
// VRT.spec.ts
// 追加する責務
- Given-When-Thenマーカーの統一
- テスト開始・終了ログ（最小限）

// 追加後の予想行数: 120-130行（少しだけ増）
```

## 📊 ログの配置戦略

### **どこに何のログを配置すべきか？**

| 層               | 配置すべきログ                                                             | 配置しないログ                                      |
| ---------------- | -------------------------------------------------------------------------- | --------------------------------------------------- |
| **BasePage**     | ✅ 共通エラーハンドリング<br/>✅ 基本的なパフォーマンス測定                  | ❌ ページ固有の詳細ログ<br/>❌ テスト固有のログ       |
| **Page Objects** | ✅ ページ操作のログ（navigate, click）<br/>✅ ページ固有のパフォーマンス測定 | ❌ システムレベルのログ<br/>❌ テスト開始・終了ログ   |
| **Fixtures**     | ✅ テストライフサイクル<br/>✅ システムイベント<br/>✅ LogManager初期化       | ❌ ページ固有の操作ログ<br/>❌ アサーション関連ログ   |
| **Test Files**   | ✅ Given-When-Thenマーカー<br/>✅ テスト固有のアサーション                   | ❌ 詳細なパフォーマンス測定<br/>❌ システム初期化ログ |

## 🔧 実装順序

### Phase 1: BasePage強化
```typescript
// BasePage.ts に最小限のログ機能追加
// - LogManager（オプション）
// - 共通ログメソッド  
// - パフォーマンス測定基盤
```

### Phase 2: Fixtures拡張
```typescript
// TestFixtures.ts に新LogManager統合
// - 既存TestLoggerとの共存
// - システムレベルログ強化
// - テストライフサイクルログ
```

### Phase 3: Page Objects強化
```typescript
// PlaywrightDevPage.ts, LocatorTestPage.ts
// - ページ固有操作ログ追加
// - VRT固有ログ（PlaywrightDevPageのみ）
// - メソッドレベルのパフォーマンス測定
```

### Phase 4: Test Files調整
```typescript
// VRT.spec.ts
// - Given-When-Thenマーカー統一
// - 新Fixturesの利用
// - 最小限のテストログ追加
```

## 🎯 設計原則

### ✅ **DO: すべきこと**
1. **既存設計パターンの踏襲**（BasePage > XXX継承）
2. **最小限の追加**（行数の大幅増加を避ける）
3. **責務の明確化**（各層で適切なログのみ）
4. **既存TestLoggerとの共存**

### ❌ **DON'T: 避けるべきこと**
1. **ファイルの大幅肥大化**（200行超え）
2. **責務の混在**（テストファイルに詳細ログ）
3. **既存TestLoggerの破壊的変更**
4. **過度な抽象化**（シンプルさを失う）

## 📈 期待される効果

### **行数の変化予測**
```
BasePage.ts:           49行 →  80行 (+31行)
PlaywrightDevPage.ts: 162行 → 190行 (+28行)  
LocatorTestPage.ts:   132行 → 160行 (+28行)
TestFixtures.ts:      137行 → 180行 (+43行)
VRT.spec.ts:          110行 → 130行 (+20行)

総計: 590行 → 740行 (+150行、25%増)
```

### **利益**
- ✅ 構造化ログによる詳細な分析
- ✅ パフォーマンス測定の自動化
- ✅ Given-When-Thenの統一
- ✅ 既存設計の保持

### **リスク回避**
- ❌ 542行の巨大ファイルは作らない
- ❌ 既存の優秀な設計を壊さない
- ❌ テストファイルを複雑化しない

## 🚀 実装開始

この計画に基づいて、Phase 1から順次実装を開始します。
